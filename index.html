<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TAMM • Sahatna • Having a Baby (Prototype)</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1620;
      --panel2:#0d131c;
      --card:#111a24;
      --card2:#0f1721;
      --text:#e8f0ff;
      --muted:rgba(232,240,255,.65);
      --muted2:rgba(232,240,255,.45);
      --line:rgba(255,255,255,.08);
      --accent:#19e3c0;
      --accent2:#21b9ff;
      --warn:#ffcc66;
      --good:#36e38e;
      --chip:rgba(255,255,255,.08);
      --shadow: 0 16px 40px rgba(0,0,0,.55);
      --radius:18px;
      --radius2:22px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background:
        radial-gradient(1200px 700px at 70% -10%, rgba(33,185,255,.25), transparent 55%),
        radial-gradient(900px 600px at -10% 20%, rgba(25,227,192,.16), transparent 55%),
        linear-gradient(180deg, #0b0f14 0%, #070a0e 100%);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    /* Phone frame */
    .phone{
      width:min(420px, 100%);
      height: min(860px, 100%);
      background: linear-gradient(180deg, #070b10 0%, #0b0f14 35%, #070a0e 100%);
      border-radius: 34px;
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .statusbar{
      height:34px;
      padding:10px 14px 0;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      font-size:12px;
      color:rgba(232,240,255,.7);
      letter-spacing:.2px;
    }
    .statusbar .right{
      display:flex; gap:10px; align-items:center;
    }
    .pill-dot{width:10px;height:10px;border-radius:999px;background:rgba(232,240,255,.35)}
    .notch{
      position:absolute; top:10px; left:50%;
      transform:translateX(-50%);
      width:140px; height:24px;
      border-radius:999px;
      background:rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(8px);
      pointer-events:none;
      opacity:.75;
    }

    /* Top gradient header (TAMM/Sahatna style) */
    .header{
      padding:14px 16px 14px;
      position:relative;
      background:
        radial-gradient(220px 160px at 30% 10%, rgba(33,185,255,.35), transparent 60%),
        radial-gradient(280px 180px at 70% -10%, rgba(25,227,192,.22), transparent 62%),
        linear-gradient(180deg, rgba(20,88,140,.55) 0%, rgba(10,20,32,.0) 70%);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .toprow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .iconbtn{
      width:36px; height:36px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      display:grid; place-items:center;
      cursor:pointer;
      transition:transform .12s ease, background .12s ease;
      user-select:none;
    }
    .iconbtn:active{transform:scale(.96)}
    .iconbtn:hover{background:rgba(255,255,255,.06)}
    .titlewrap{
      display:flex; flex-direction:column;
      line-height:1.15;
      gap:3px;
      min-width:0;
      flex:1;
    }
    .space{
      font-size:12px;
      color:rgba(232,240,255,.65);
    }
    .journey{
      font-size:20px;
      font-weight:750;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .subtitle{
      font-size:12px;
      color:rgba(232,240,255,.55);
      margin-top:2px;
    }

    .stagebar{
      display:flex;
      gap:8px;
      overflow:auto;
      padding-bottom:2px;
      scrollbar-width:none;
    }
    .stagebar::-webkit-scrollbar{display:none}
    .stage{
      flex:0 0 auto;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.08);
      color:rgba(232,240,255,.75);
      font-size:12px;
      cursor:pointer;
      user-select:none;
      transition:background .15s ease, transform .12s ease, border-color .15s ease;
      display:flex; align-items:center; gap:8px;
    }
    .stage .dot{
      width:8px;height:8px;border-radius:999px;background:rgba(232,240,255,.30);
    }
    .stage.active{
      background:linear-gradient(135deg, rgba(25,227,192,.20), rgba(33,185,255,.18));
      border-color:rgba(33,185,255,.35);
      color:rgba(232,240,255,.95);
    }
    .stage.active .dot{background:var(--accent)}
    .stage:active{transform:scale(.98)}

    /* Content */
    .content{
      height: calc(100% - 34px - 0px);
      overflow:auto;
      padding:14px 14px 110px;
      scrollbar-width:thin;
      scrollbar-color: rgba(255,255,255,.12) transparent;
    }
    .section{
      margin-top:12px;
    }
    .sectionhead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin:14px 2px 10px;
    }
    .sectionhead h3{
      margin:0;
      font-size:14px;
      letter-spacing:.2px;
    }
    .linkbtn{
      border:none;
      background:none;
      color:rgba(33,185,255,.95);
      font-size:12px;
      cursor:pointer;
      padding:6px 8px;
      border-radius:10px;
    }
    .linkbtn:hover{background:rgba(33,185,255,.08)}

    .card{
      background:linear-gradient(180deg, rgba(17,26,36,.92), rgba(13,19,28,.92));
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius2);
      padding:14px;
      box-shadow: 0 14px 30px rgba(0,0,0,.35);
    }
    .card + .card{margin-top:10px}
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .muted{color:var(--muted)}
    .muted2{color:var(--muted2)}
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    .chip{
      font-size:11px;
      padding:7px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.08);
      color:rgba(232,240,255,.70);
    }

    .cta{
      display:flex;
      gap:10px;
      margin-top:12px;
    }
    .btn{
      border:none;
      cursor:pointer;
      border-radius:999px;
      padding:11px 14px;
      font-weight:650;
      font-size:13px;
      letter-spacing:.15px;
      transition:transform .12s ease, filter .12s ease, background .12s ease;
      user-select:none;
    }
    .btn:active{transform:scale(.98)}
    .btn.primary{
      background:linear-gradient(135deg, rgba(25,227,192,1), rgba(33,185,255,.85));
      color:#052019;
      flex:1;
    }
    .btn.ghost{
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      color:rgba(232,240,255,.90);
    }
    .btn.small{padding:9px 12px; font-size:12px}

    .kpiwrap{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px}
    .kpi{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      padding:12px;
    }
    .kpi .label{font-size:11px;color:rgba(232,240,255,.60)}
    .kpi .value{font-size:18px;font-weight:800;margin-top:4px}
    .kpi .hint{font-size:11px;color:rgba(232,240,255,.45);margin-top:4px}

    /* List items */
    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .item{
      background:linear-gradient(180deg, rgba(15,23,33,.88), rgba(12,18,26,.88));
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px;
      padding:12px;
      display:flex;
      gap:12px;
      cursor:pointer;
      transition:transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .item:hover{
      background:linear-gradient(180deg, rgba(15,26,38,.92), rgba(12,18,26,.92));
      border-color:rgba(33,185,255,.20);
    }
    .item:active{transform:scale(.99)}
    .thumb{
      width:56px;height:56px;border-radius:14px;
      background:
        radial-gradient(40px 40px at 30% 30%, rgba(33,185,255,.35), transparent 65%),
        radial-gradient(50px 50px at 80% 20%, rgba(25,227,192,.25), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.08), rgba(0,0,0,.05));
      border:1px solid rgba(255,255,255,.08);
      flex:0 0 auto;
      display:grid; place-items:center;
    }
    .item .meta{min-width:0}
    .item .meta .t{
      font-weight:750;
      font-size:13px;
      margin:2px 0 4px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .item .meta .d{
      font-size:12px; color:rgba(232,240,255,.55);
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;
      overflow:hidden;
    }
    .tags{display:flex; flex-wrap:wrap; gap:6px; margin-top:8px}
    .tag{
      font-size:11px; padding:5px 8px; border-radius:999px;
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.08);
      color:rgba(232,240,255,.65);
    }
    .chev{
      margin-left:auto;
      color:rgba(232,240,255,.35);
      display:flex; align-items:center;
      padding-left:6px;
    }

    /* Modal */
    .modalback{
      position:absolute; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding:12px;
    }
    .modal{
      width:100%;
      max-width:420px;
      background:linear-gradient(180deg, rgba(18,26,38,.98), rgba(10,14,20,.98));
      border:1px solid rgba(255,255,255,.10);
      border-radius:26px;
      box-shadow: var(--shadow);
      padding:14px;
      transform:translateY(6px);
      animation: up .16s ease-out;
    }
    @keyframes up{from{transform:translateY(18px); opacity:.6} to{transform:translateY(6px); opacity:1}}
    .modal .handle{
      width:46px;height:5px;border-radius:999px;background:rgba(255,255,255,.18);
      margin:4px auto 10px;
    }
    .modal h4{margin:4px 2px 6px; font-size:14px}
    .modal p{margin:0 2px 10px; font-size:12px; color:rgba(232,240,255,.58); line-height:1.45}
    .modal .grid{
      display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:8px;
    }
    .modal .opt{
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.06);
      cursor:pointer;
      transition:transform .12s ease, background .12s ease;
    }
    .modal .opt:hover{background:rgba(33,185,255,.10)}
    .modal .opt:active{transform:scale(.99)}
    .modal .opt .k{font-size:11px; color:rgba(232,240,255,.60)}
    .modal .opt .v{font-size:13px; font-weight:750; margin-top:4px}

    /* Bottom nav */
    .nav{
      position:absolute; left:0; right:0; bottom:0;
      padding:10px 10px 14px;
      background:linear-gradient(180deg, rgba(11,15,20,0) 0%, rgba(11,15,20,.75) 25%, rgba(11,15,20,.96) 100%);
      border-top:1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(10px);
    }
    .navrow{
      display:flex; justify-content:space-around; gap:10px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:22px;
      padding:10px 8px;
    }
    .navbtn{
      display:flex; flex-direction:column; align-items:center; gap:6px;
      font-size:11px; color:rgba(232,240,255,.55);
      padding:8px 10px;
      border-radius:16px;
      cursor:pointer;
      user-select:none;
    }
    .navbtn.active{
      color:rgba(232,240,255,.92);
      background:linear-gradient(135deg, rgba(25,227,192,.16), rgba(33,185,255,.14));
      border:1px solid rgba(33,185,255,.18);
    }
    .navicon{
      width:22px;height:22px;border-radius:8px;
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.08);
      display:grid; place-items:center;
      color:rgba(232,240,255,.70);
    }

    /* Simple icons */
    .svg{width:16px;height:16px; display:block}
    .svg.big{width:18px;height:18px}
    .divider{height:1px;background:rgba(255,255,255,.06);margin:10px 0}

    /* Empty states */
    .empty{
      font-size:12px;
      color:rgba(232,240,255,.50);
      padding:10px 12px;
      background:rgba(255,255,255,.04);
      border:1px dashed rgba(255,255,255,.12);
      border-radius:16px;
    }

    /* Toast */
    .toast{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom:92px;
      background:rgba(12,18,26,.95);
      border:1px solid rgba(255,255,255,.10);
      border-radius:999px;
      padding:10px 12px;
      font-size:12px;
      color:rgba(232,240,255,.85);
      display:none;
      box-shadow:0 10px 30px rgba(0,0,0,.5);
      white-space:nowrap;
      max-width:90%;
      overflow:hidden;
      text-overflow:ellipsis;
    }
  </style>
</head>
<body>
  <div class="phone" role="application" aria-label="TAMM prototype phone">
    <div class="notch" aria-hidden="true"></div>

    <div class="statusbar">
      <div>9:41</div>
      <div class="right">
        <div class="pill-dot"></div>
        <div class="pill-dot"></div>
        <div class="pill-dot"></div>
      </div>
    </div>

    <div class="header">
      <div class="toprow">
        <button class="iconbtn" id="backBtn" aria-label="Back">
          <svg class="svg big" viewBox="0 0 24 24" fill="none">
            <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <div class="titlewrap">
          <div class="space">Sahatna Space</div>
          <div class="journey">Having a Baby</div>
          <div class="subtitle" id="stageSubtitle">Dashboard • Start here after your positive test</div>
        </div>

        <button class="iconbtn" id="infoBtn" aria-label="Info">
          <svg class="svg big" viewBox="0 0 24 24" fill="none">
            <path d="M12 17v-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M12 7h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            <path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      </div>

      <div class="stagebar" id="stagebar" aria-label="Journey stages">
        <div class="stage active" data-stage="pre" role="button" tabindex="0"><span class="dot"></span>Pre-conception</div>
        <div class="stage" data-stage="preg" role="button" tabindex="0"><span class="dot"></span>Pregnancy</div>
        <div class="stage" data-stage="birth" role="button" tabindex="0"><span class="dot"></span>Birth</div>
        <div class="stage" data-stage="post" role="button" tabindex="0"><span class="dot"></span>Post-birth</div>
      </div>
    </div>

    <div class="content" id="content">
      <!-- Dynamic content injected here -->
    </div>

    <div class="toast" id="toast"></div>

    <div class="nav" aria-label="Bottom navigation">
      <div class="navrow">
        <div class="navbtn active" data-view="dashboard">
          <div class="navicon">
            <svg class="svg" viewBox="0 0 24 24" fill="none">
              <path d="M4 11h7V4H4v7Zm9 9h7v-7h-7v7ZM4 20h7v-7H4v7Zm9-9h7V4h-7v7Z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
            </svg>
          </div>
          Dashboard
        </div>
        <div class="navbtn" data-view="resources">
          <div class="navicon">
            <svg class="svg" viewBox="0 0 24 24" fill="none">
              <path d="M6 4h12v16H6V4Z" stroke="currentColor" stroke-width="1.8"/>
              <path d="M9 8h6M9 12h6M9 16h4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </div>
          Resources
        </div>
        <div class="navbtn" data-view="appointments">
          <div class="navicon">
            <svg class="svg" viewBox="0 0 24 24" fill="none">
              <path d="M7 3v3M17 3v3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M4 8h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M6 6h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="1.8"/>
              <path d="M8 12h4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </div>
          Appointments
        </div>
        <div class="navbtn" data-view="profile">
          <div class="navicon">
            <svg class="svg" viewBox="0 0 24 24" fill="none">
              <path d="M20 21a8 8 0 1 0-16 0" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M12 13a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke="currentColor" stroke-width="1.8"/>
            </svg>
          </div>
          Me
        </div>
      </div>
    </div>

    <!-- Bottom sheet modal -->
    <div class="modalback" id="modalBack" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-label="Details">
        <div class="handle"></div>
        <h4 id="modalTitle">Title</h4>
        <p id="modalDesc">Description</p>
        <div class="divider"></div>
        <div class="grid" id="modalGrid"></div>
        <div class="cta">
          <button class="btn ghost" id="modalClose">Close</button>
          <button class="btn primary" id="modalPrimary">Take action</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Data model (initial prototype placeholders) =====
    const STAGES = {
      pre: {
        name: "Pre-conception",
        subtitle: "Dashboard • Start here after your positive test (or planning stage)",
        heroTitle: "Set up your journey",
        heroDesc: "Confirm your stage, add your preferences, and start receiving tailored guidance. This prototype assumes the journey begins after a positive test.",
        chips: ["Positive test received", "Personalized education", "Next steps"],
        kpis: [
          {label:"Stage", value:"Pre-conception", hint:"You can change anytime"},
          {label:"Plan status", value:"Draft", hint:"Complete onboarding"}
        ],
        actions: [
          { id:"verify", title:"Confirm pregnancy test result", desc:"Record the hospital-confirmed result and date.", tags:["Hospital"], primary:"Confirm" },
          { id:"profile", title:"Set your preferences", desc:"Language, reminders, content topics, and privacy controls.", tags:["Personalize"], primary:"Update" }
        ],
        resources: [
          { id:"r1", title:"What happens after a positive test?", desc:"A simple checklist of the first steps to take after confirmation.", tags:["Checklist","Getting Started"] },
          { id:"r2", title:"Choosing your care pathway", desc:"Understand options: public/private, OB-GYN visits, and key screenings.", tags:["Care Plan","Basics"] }
        ],
        appointments: { upcoming: [], suggested: ["Book first OB-GYN visit", "Baseline blood tests (if advised)"] }
      },

      preg: {
        name: "Pregnancy",
        subtitle: "Dashboard • Week-by-week guidance & milestones",
        heroTitle: "Track progress with confidence",
        heroDesc: "Follow your baby’s growth, appointments, and education tailored to your trimester.",
        chips: ["Milestones", "Appointments", "Trimester tips"],
        kpis: [
          {label:"Trimester", value:"1st", hint:"Prototype value"},
          {label:"Next milestone", value:"First scan", hint:"Typically early pregnancy"}
        ],
        actions: [
          { id:"scan", title:"Schedule early scan", desc:"Set your scan appointment and reminders.", tags:["Scan","Reminder"], primary:"Schedule" },
          { id:"vitamins", title:"Daily supplements reminder", desc:"Set a routine for prenatal vitamins (as advised).", tags:["Routine"], primary:"Set reminder" }
        ],
        resources: [
          { id:"r3", title:"Nutrition basics in pregnancy", desc:"What to eat, what to avoid, and hydration tips.", tags:["Nutrition","Safety"] },
          { id:"r4", title:"Common symptoms: what’s normal?", desc:"Learn when to self-care vs. when to seek help.", tags:["Symptoms","Guidance"] }
        ],
        appointments: { upcoming: ["OB-GYN consultation • TBD"], suggested: ["Book scan", "Prenatal labs"] }
      },

      birth: {
        name: "Birth",
        subtitle: "Dashboard • Plan delivery & prepare for hospital",
        heroTitle: "Prepare for delivery",
        heroDesc: "Build a birth plan, understand admission steps, and pack essentials.",
        chips: ["Birth plan", "Hospital prep", "Support"],
        kpis: [
          {label:"Plan", value:"Not started", hint:"Create birth plan"},
          {label:"Hospital", value:"Select", hint:"Choose facility"}
        ],
        actions: [
          { id:"birthplan", title:"Create your birth plan", desc:"Pain relief preferences, support person, and care options.", tags:["Plan"], primary:"Create" },
          { id:"bag", title:"Pack your hospital bag", desc:"Generate a checklist and track readiness.", tags:["Checklist"], primary:"Start" }
        ],
        resources: [
          { id:"r5", title:"Signs of labor", desc:"What to watch for and when to go to hospital.", tags:["Labor","Urgent"] },
          { id:"r6", title:"Hospital admission checklist", desc:"Documents, insurance, and what to expect at triage.", tags:["Hospital","Checklist"] }
        ],
        appointments: { upcoming: [], suggested: ["Birth planning visit", "Hospital tour (if available)"] }
      },

      post: {
        name: "Post-birth",
        subtitle: "Dashboard • Recovery, newborn care & follow-ups",
        heroTitle: "Care designed for you and your child",
        heroDesc: "Support recovery, feeding guidance, immunizations, and follow-up appointments.",
        chips: ["Recovery", "Newborn care", "Immunizations"],
        kpis: [
          {label:"Recovery", value:"Week 1", hint:"Prototype value"},
          {label:"Next follow-up", value:"Postnatal check", hint:"Schedule if needed"}
        ],
        actions: [
          { id:"followup", title:"Schedule postnatal check", desc:"Book your check and set reminders.", tags:["Appointment"], primary:"Book" },
          { id:"newborn", title:"Newborn routine setup", desc:"Feeding, sleep, and immunization reminders.", tags:["Baby"], primary:"Set up" }
        ],
        resources: [
          { id:"r7", title:"Postnatal recovery guide", desc:"Physical recovery, warning signs, and support.", tags:["Recovery","Guidance"] },
          { id:"r8", title:"Newborn feeding basics", desc:"Breastfeeding/formula basics and when to seek help.", tags:["Feeding","Basics"] }
        ],
        appointments: { upcoming: ["Newborn check • TBD"], suggested: ["Immunization schedule", "Postnatal visit"] }
      }
    };

    const VIEWS = ["dashboard","resources","appointments","profile"];

    // ===== UI refs =====
    const contentEl = document.getElementById("content");
    const stageSubtitle = document.getElementById("stageSubtitle");
    const stageBar = document.getElementById("stagebar");
    const navBtns = Array.from(document.querySelectorAll(".navbtn"));
    const toastEl = document.getElementById("toast");

    // Modal
    const modalBack = document.getElementById("modalBack");
    const modalTitle = document.getElementById("modalTitle");
    const modalDesc  = document.getElementById("modalDesc");
    const modalGrid  = document.getElementById("modalGrid");
    const modalClose = document.getElementById("modalClose");
    const modalPrimary = document.getElementById("modalPrimary");

    // State
    let state = {
      stage: "pre",
      view: "dashboard",
      onboardingComplete: false,
      profileSet: false,
      remindersEnabled: false
    };

    // ===== Helpers =====
    function showToast(msg){
      toastEl.textContent = msg;
      toastEl.style.display = "block";
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> toastEl.style.display = "none", 2200);
    }

    function openModal({title, desc, options = [], primaryLabel="Done", primaryAction=()=>{}}){
      modalTitle.textContent = title;
      modalDesc.textContent = desc;
      modalGrid.innerHTML = "";
      options.forEach(opt=>{
        const div = document.createElement("div");
        div.className = "opt";
        div.innerHTML = `<div class="k">${opt.k}</div><div class="v">${opt.v}</div>`;
        div.onclick = () => opt.onClick?.();
        modalGrid.appendChild(div);
      });
      modalPrimary.textContent = primaryLabel;
      modalPrimary.onclick = () => { primaryAction(); closeModal(); };
      modalBack.style.display = "flex";
      modalBack.setAttribute("aria-hidden","false");
    }

    function closeModal(){
      modalBack.style.display = "none";
      modalBack.setAttribute("aria-hidden","true");
    }

    function setStage(stageKey){
      state.stage = stageKey;
      // update stage pills
      Array.from(stageBar.querySelectorAll(".stage")).forEach(el=>{
        el.classList.toggle("active", el.dataset.stage === stageKey);
      });
      stageSubtitle.textContent = STAGES[stageKey].subtitle;
      render();
      showToast(`Stage set to: ${STAGES[stageKey].name}`);
    }

    function setView(view){
      state.view = view;
      navBtns.forEach(b=> b.classList.toggle("active", b.dataset.view === view));
      render();
    }

    function svgBadge(kind){
      // Minimal “icon” inside thumb
      const map = {
        checklist: `<svg class="svg" viewBox="0 0 24 24" fill="none">
          <path d="M9 6h12M9 12h12M9 18h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M3.5 6l1.2 1.2L7.1 4.8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M3.5 12l1.2 1.2 2.4-2.4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M3.5 18l1.2 1.2 2.4-2.4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>`,
        book: `<svg class="svg" viewBox="0 0 24 24" fill="none">
          <path d="M6 4h12v16H6V4Z" stroke="currentColor" stroke-width="2"/>
          <path d="M9 8h6M9 12h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>`,
        bolt: `<svg class="svg" viewBox="0 0 24 24" fill="none">
          <path d="M13 2L3 14h8l-1 8 11-13h-8l0-7Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </svg>`,
        cal: `<svg class="svg" viewBox="0 0 24 24" fill="none">
          <path d="M7 3v3M17 3v3M4 8h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M6 6h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2"/>
        </svg>`
      };
      return map[kind] || map.book;
    }

    // ===== Renderers =====
    function renderDashboard(){
      const s = STAGES[state.stage];

      const hero = `
        <div class="card">
          <div class="row">
            <div style="min-width:0">
              <div style="font-size:12px;color:rgba(232,240,255,.60);margin-bottom:6px">Journey dashboard</div>
              <div style="font-size:18px;font-weight:820;letter-spacing:.2px">${s.heroTitle}</div>
              <div class="muted" style="font-size:12px;line-height:1.45;margin-top:6px">${s.heroDesc}</div>
            </div>
            <div class="thumb" aria-hidden="true">${svgBadge("bolt")}</div>
          </div>

          <div class="chips">
            ${s.chips.map(c=>`<span class="chip">${c}</span>`).join("")}
          </div>

          <div class="kpiwrap">
            ${s.kpis.map(k=>`
              <div class="kpi">
                <div class="label">${k.label}</div>
                <div class="value">${k.value}</div>
                <div class="hint">${k.hint}</div>
              </div>
            `).join("")}
          </div>

          <div class="cta">
            <button class="btn primary" id="btnStart">${state.onboardingComplete ? "Continue journey" : "Start journey"}</button>
            <button class="btn ghost" id="btnEditStage">Change stage</button>
          </div>
        </div>
      `;

      const actions = `
        <div class="section">
          <div class="sectionhead">
            <h3>Actions</h3>
            <button class="linkbtn" id="actionsAll">View all</button>
          </div>

          ${
            (s.actions?.length)
              ? s.actions.slice(0,2).map(a=>`
                <div class="card" style="padding:12px 12px">
                  <div class="row">
                    <div style="min-width:0">
                      <div style="font-weight:800">${a.title}</div>
                      <div class="muted" style="font-size:12px;margin-top:4px;line-height:1.45">${a.desc}</div>
                      <div class="tags">${a.tags.map(t=>`<span class="tag">${t}</span>`).join("")}</div>
                    </div>
                    <button class="btn small ghost" data-action="${a.id}">${a.primary}</button>
                  </div>
                </div>
              `).join("")
              : `<div class="empty">No actions to complete right now.</div>`
          }
        </div>
      `;

      const wellness = `
        <div class="section">
          <div class="sectionhead">
            <h3>My Wellness</h3>
            <button class="linkbtn" id="wellnessAll">View all</button>
          </div>

          <div class="card">
            <div class="row">
              <div style="min-width:0">
                <div style="font-weight:820">Connect your smart device</div>
                <div class="muted" style="font-size:12px;margin-top:5px;line-height:1.45">
                  Get insights about your health directly from your smart device (prototype placeholder).
                </div>
              </div>
              <div class="thumb" aria-hidden="true">${svgBadge("bolt")}</div>
            </div>
            <div class="cta">
              <button class="btn primary" id="connectDevice">Connect device</button>
              <button class="btn ghost" id="privacy">Privacy</button>
            </div>
          </div>
        </div>
      `;

      const appts = `
        <div class="section">
          <div class="sectionhead">
            <h3>My Appointments</h3>
            <button class="linkbtn" id="apptsAll">View all</button>
          </div>

          <div class="card">
            ${
              (s.appointments.upcoming?.length)
                ? `<div class="list">
                    ${s.appointments.upcoming.map(u=>`
                      <div class="item" data-item="appt" data-title="${escapeHtml(u)}">
                        <div class="thumb">${svgBadge("cal")}</div>
                        <div class="meta">
                          <div class="t">${escapeHtml(u)}</div>
                          <div class="d">Tap to view details or reschedule.</div>
                          <div class="tags"><span class="tag">Upcoming</span><span class="tag">${s.name}</span></div>
                        </div>
                        <div class="chev">›</div>
                      </div>
                    `).join("")}
                  </div>`
                : `<div class="muted" style="font-size:12px;line-height:1.45">
                    You have no upcoming appointments in this prototype.
                  </div>`
            }

            <div class="cta">
              <button class="btn primary" id="bookAppt">Book appointment</button>
              <button class="btn ghost" id="viewAppts">View my appointments</button>
            </div>

            <div class="divider"></div>
            <div class="muted2" style="font-size:11px;margin-bottom:8px">Suggested next steps</div>
            <div class="chips">
              ${s.appointments.suggested.map(x=>`<span class="chip">${x}</span>`).join("")}
            </div>
          </div>
        </div>
      `;

      const resources = `
        <div class="section">
          <div class="sectionhead">
            <h3>Tailored Education</h3>
            <button class="linkbtn" id="resourcesAll">View all</button>
          </div>

          <div class="list">
            ${s.resources.slice(0,3).map((r,i)=>`
              <div class="item" data-item="resource" data-id="${r.id}">
                <div class="thumb">${svgBadge(i===0 ? "checklist":"book")}</div>
                <div class="meta">
                  <div class="t">${escapeHtml(r.title)}</div>
                  <div class="d">${escapeHtml(r.desc)}</div>
                  <div class="tags">${r.tags.map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("")}</div>
                </div>
                <div class="chev">›</div>
              </div>
            `).join("")}
          </div>
        </div>
      `;

      const quickTools = `
        <div class="section">
          <div class="sectionhead">
            <h3>Quick Tools</h3>
            <button class="linkbtn" id="toolsAll">View all</button>
          </div>

          <div class="card" style="padding:10px">
            <div class="item" data-item="tool" data-title="Milestones">
              <div class="thumb">${svgBadge("bolt")}</div>
              <div class="meta">
                <div class="t">Milestones</div>
                <div class="d">A stage-aware timeline of key moments (prototype).</div>
              </div>
              <div class="chev">›</div>
            </div>

            <div class="item" data-item="tool" data-title="My Assessment">
              <div class="thumb">${svgBadge("book")}</div>
              <div class="meta">
                <div class="t">My Assessment</div>
                <div class="d">Answer a few questions to tailor content.</div>
              </div>
              <div class="chev">›</div>
            </div>

            <div class="item" data-item="tool" data-title="Reminders">
              <div class="thumb">${svgBadge("cal")}</div>
              <div class="meta">
                <div class="t">Reminders</div>
                <div class="d">${state.remindersEnabled ? "Enabled" : "Not set"} • Manage notifications</div>
              </div>
              <div class="chev">›</div>
            </div>
          </div>
        </div>
      `;

      contentEl.innerHTML = hero + actions + wellness + appts + resources + quickTools;

      // Wire up dashboard buttons
      document.getElementById("btnStart").onclick = () => {
        state.onboardingComplete = true;
        showToast("Journey started (prototype).");
        render(); // update labels
      };

      document.getElementById("btnEditStage").onclick = () => openStagePicker();

      document.getElementById("connectDevice").onclick = () => showToast("Connect device (prototype).");
      document.getElementById("privacy").onclick = () => openModal({
        title:"Privacy (prototype)",
        desc:"This is a placeholder. Later you can define consent, sharing, and data visibility.",
        options:[
          {k:"Data sharing", v:"Off (default)", onClick: ()=>showToast("Set data sharing (prototype).")},
          {k:"Notifications", v: state.remindersEnabled ? "On" : "Off", onClick: ()=>showToast("Open notifications (prototype).")}
        ],
        primaryLabel:"Got it",
        primaryAction: ()=>{}
      });

      document.getElementById("bookAppt").onclick = ()=> openModal({
        title:"Book appointment",
        desc:"Prototype placeholder: choose an appointment type for this stage.",
        options:[
          {k:"Suggested", v: STAGES[state.stage].appointments.suggested[0] || "Consultation", onClick: ()=>showToast("Selected suggested appointment.")},
          {k:"Other", v:"Choose from list", onClick: ()=>showToast("Open appointment list (prototype).")}
        ],
        primaryLabel:"Proceed",
        primaryAction: ()=> showToast("Appointment flow (prototype).")
      });

      document.getElementById("viewAppts").onclick = ()=> setView("appointments");

      // Action buttons
      contentEl.querySelectorAll('[data-action]').forEach(btn=>{
        btn.onclick = (e)=>{
          const id = e.currentTarget.dataset.action;
          handleAction(id);
        };
      });

      // Item cards
      contentEl.querySelectorAll(".item").forEach(it=>{
        it.onclick = ()=>{
          const type = it.dataset.item;
          if(type === "resource"){
            const rid = it.dataset.id;
            openResource(rid);
          } else if(type === "tool"){
            openTool(it.dataset.title);
          } else if(type === "appt"){
            openModal({
              title: it.dataset.title || "Appointment",
              desc:"Prototype placeholder. Later: full details, location, clinician, and reschedule/cancel actions.",
              options:[
                {k:"Status", v:"Draft", onClick: ()=>{}},
                {k:"Reminders", v: state.remindersEnabled ? "On" : "Off", onClick: ()=>{ state.remindersEnabled = !state.remindersEnabled; showToast("Toggled reminders."); } }
              ],
              primaryLabel:"Reschedule",
              primaryAction: ()=> showToast("Reschedule (prototype).")
            });
          }
        };
      });

      // Quick links
      document.getElementById("resourcesAll").onclick = ()=> setView("resources");
    }

    function renderResources(){
      const s = STAGES[state.stage];
      const header = `
        <div class="card">
          <div class="row">
            <div style="min-width:0">
              <div style="font-size:12px;color:rgba(232,240,255,.60);margin-bottom:6px">Tailored education • ${s.name}</div>
              <div style="font-size:18px;font-weight:820">Resources</div>
              <div class="muted" style="font-size:12px;line-height:1.45;margin-top:6px">
                Filter/sort are placeholders for the next iteration.
              </div>
            </div>
            <div class="thumb">${svgBadge("book")}</div>
          </div>
          <div class="cta">
            <button class="btn ghost" id="filterBtn">Filter</button>
            <button class="btn ghost" id="sortBtn">Sort</button>
            <button class="btn primary" id="assessmentBtn">Take assessment</button>
          </div>
        </div>
      `;

      const list = `
        <div class="section">
          <div class="list">
            ${s.resources.map((r,i)=>`
              <div class="item" data-item="resource" data-id="${r.id}">
                <div class="thumb">${svgBadge(i%2===0 ? "checklist":"book")}</div>
                <div class="meta">
                  <div class="t">${escapeHtml(r.title)}</div>
                  <div class="d">${escapeHtml(r.desc)}</div>
                  <div class="tags">${r.tags.map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("")}</div>
                </div>
                <div class="chev">›</div>
              </div>
            `).join("")}
          </div>
        </div>
      `;

      contentEl.innerHTML = header + list;

      document.getElementById("filterBtn").onclick = ()=> showToast("Filter (prototype).");
      document.getElementById("sortBtn").onclick = ()=> showToast("Sort (prototype).");
      document.getElementById("assessmentBtn").onclick = ()=> openTool("My Assessment");

      contentEl.querySelectorAll('[data-item="resource"]').forEach(it=>{
        it.onclick = ()=> openResource(it.dataset.id);
      });
    }

    function renderAppointments(){
      const s = STAGES[state.stage];

      const card = `
        <div class="card">
          <div class="row">
            <div style="min-width:0">
              <div style="font-size:12px;color:rgba(232,240,255,.60);margin-bottom:6px">Appointments</div>
              <div style="font-size:18px;font-weight:820">Your schedule</div>
              <div class="muted" style="font-size:12px;line-height:1.45;margin-top:6px">
                This is a placeholder view. Later: clinic locations, clinicians, calendar integration, and queue/triage info.
              </div>
            </div>
            <div class="thumb">${svgBadge("cal")}</div>
          </div>
          <div class="cta">
            <button class="btn primary" id="bookFromAppts">Book appointment</button>
            <button class="btn ghost" id="toggleReminders">${state.remindersEnabled ? "Disable reminders" : "Enable reminders"}</button>
          </div>
        </div>
      `;

      const upcoming = (s.appointments.upcoming?.length)
        ? `
          <div class="section">
            <div class="sectionhead"><h3>Upcoming</h3><button class="linkbtn" id="exportBtn">Export</button></div>
            <div class="list">
              ${s.appointments.upcoming.map(u=>`
                <div class="item" data-item="appt" data-title="${escapeHtml(u)}">
                  <div class="thumb">${svgBadge("cal")}</div>
                  <div class="meta">
                    <div class="t">${escapeHtml(u)}</div>
                    <div class="d">Tap to view details.</div>
                    <div class="tags"><span class="tag">Upcoming</span><span class="tag">${s.name}</span></div>
                  </div>
                  <div class="chev">›</div>
                </div>
              `).join("")}
            </div>
          </div>
        `
        : `
          <div class="section">
            <div class="sectionhead"><h3>Upcoming</h3></div>
            <div class="empty">No appointments saved yet for this stage (prototype).</div>
          </div>
        `;

      const suggested = `
        <div class="section">
          <div class="sectionhead"><h3>Suggested</h3></div>
          <div class="card">
            <div class="muted2" style="font-size:11px;margin-bottom:8px">Based on your stage</div>
            <div class="chips">
              ${s.appointments.suggested.map(x=>`<span class="chip">${x}</span>`).join("")}
            </div>
          </div>
        </div>
      `;

      contentEl.innerHTML = card + upcoming + suggested;

      document.getElementById("bookFromAppts").onclick = ()=> showToast("Book appointment (prototype).");
      document.getElementById("toggleReminders").onclick = ()=>{
        state.remindersEnabled = !state.remindersEnabled;
        showToast(state.remindersEnabled ? "Reminders enabled." : "Reminders disabled.");
        render();
      };

      const exportBtn = document.getElementById("exportBtn");
      if(exportBtn) exportBtn.onclick = ()=> showToast("Export (prototype).");

      contentEl.querySelectorAll('[data-item="appt"]').forEach(it=>{
        it.onclick = ()=> openModal({
          title: it.dataset.title || "Appointment",
          desc:"Prototype placeholder for appointment details.",
          options:[
            {k:"Location", v:"TBD", onClick: ()=>{}},
            {k:"Reminders", v: state.remindersEnabled ? "On" : "Off", onClick: ()=>{ state.remindersEnabled = !state.remindersEnabled; showToast("Toggled reminders."); } }
          ],
          primaryLabel:"Reschedule",
          primaryAction: ()=> showToast("Reschedule (prototype).")
        });
      });
    }

    function renderProfile(){
      const s = STAGES[state.stage];
      contentEl.innerHTML = `
        <div class="card">
          <div class="row">
            <div style="min-width:0">
              <div style="font-size:12px;color:rgba(232,240,255,.60);margin-bottom:6px">Me</div>
              <div style="font-size:18px;font-weight:820">Preferences & profile</div>
              <div class="muted" style="font-size:12px;line-height:1.45;margin-top:6px">
                This is a placeholder for user profile, language, consent, and content preferences.
              </div>
            </div>
            <div class="thumb">${svgBadge("book")}</div>
          </div>

          <div class="divider"></div>

          <div class="kpiwrap">
            <div class="kpi">
              <div class="label">Current stage</div>
              <div class="value">${s.name}</div>
              <div class="hint">Used to tailor content</div>
            </div>
            <div class="kpi">
              <div class="label">Reminders</div>
              <div class="value">${state.remindersEnabled ? "On" : "Off"}</div>
              <div class="hint">Appointments & habits</div>
            </div>
          </div>

          <div class="cta">
            <button class="btn primary" id="editPrefs">${state.profileSet ? "Edit preferences" : "Set preferences"}</button>
            <button class="btn ghost" id="consentBtn">Consent & privacy</button>
          </div>
        </div>

        <div class="section">
          <div class="sectionhead">
            <h3>Quick settings</h3>
          </div>
          <div class="card" style="padding:10px">
            <div class="item" data-item="setting" data-title="Language">
              <div class="thumb">${svgBadge("book")}</div>
              <div class="meta">
                <div class="t">Language</div>
                <div class="d">English (prototype)</div>
              </div>
              <div class="chev">›</div>
            </div>

            <div class="item" data-item="setting" data-title="Notifications">
              <div class="thumb">${svgBadge("cal")}</div>
              <div class="meta">
                <div class="t">Notifications</div>
                <div class="d">${state.remindersEnabled ? "Enabled" : "Disabled"}</div>
              </div>
              <div class="chev">›</div>
            </div>

            <div class="item" data-item="setting" data-title="Topics">
              <div class="thumb">${svgBadge("bolt")}</div>
              <div class="meta">
                <div class="t">Topics</div>
                <div class="d">Nutrition • Symptoms • Appointments (prototype)</div>
              </div>
              <div class="chev">›</div>
            </div>
          </div>
        </div>
      `;

      document.getElementById("editPrefs").onclick = ()=>{
        state.profileSet = true;
        showToast("Preferences saved (prototype).");
        render();
      };

      document.getElementById("consentBtn").onclick = ()=>{
        openModal({
          title:"Consent & privacy",
          desc:"Prototype placeholder. Later: granular consent for medical info, device data, and content personalization.",
          options:[
            {k:"Medical data", v:"Limited", onClick: ()=>showToast("Medical data consent (prototype).")},
            {k:"Device data", v:"Optional", onClick: ()=>showToast("Device consent (prototype).")}
          ],
          primaryLabel:"Save",
          primaryAction: ()=> showToast("Saved (prototype).")
        });
      };

      contentEl.querySelectorAll('[data-item="setting"]').forEach(it=>{
        it.onclick = ()=> showToast(`${it.dataset.title} (prototype).`);
      });
    }

    function render(){
      const s = STAGES[state.stage];
      stageSubtitle.textContent = s.subtitle;

      if(state.view === "dashboard") renderDashboard();
      if(state.view === "resources") renderResources();
      if(state.view === "appointments") renderAppointments();
      if(state.view === "profile") renderProfile();
    }

    // ===== Behaviors =====
    function openStagePicker(){
      openModal({
        title:"Choose journey stage",
        desc:"This changes the dashboard and the educational content you see (prototype).",
        options:[
          {k:"Stage", v:"Pre-conception", onClick: ()=> setStage("pre")},
          {k:"Stage", v:"Pregnancy", onClick: ()=> setStage("preg")},
          {k:"Stage", v:"Birth", onClick: ()=> setStage("birth")},
          {k:"Stage", v:"Post-birth", onClick: ()=> setStage("post")}
        ],
        primaryLabel:"Done",
        primaryAction: ()=>{}
      });
    }

    function openResource(resourceId){
      const s = STAGES[state.stage];
      const r = s.resources.find(x=>x.id===resourceId);
      if(!r) return;

      openModal({
        title: r.title,
        desc: r.desc + "  \n\nLater: full article/video view, save/bookmark, and related resources.",
        options:[
          {k:"Type", v: r.tags[0] || "Resource"},
          {k:"Stage", v: s.name},
          {k:"Save", v:"Bookmark", onClick: ()=> showToast("Saved (prototype).")},
          {k:"Share", v:"Send link", onClick: ()=> showToast("Share (prototype).")}
        ],
        primaryLabel:"Open",
        primaryAction: ()=> showToast("Open resource (prototype).")
      });
    }

    function openTool(title){
      openModal({
        title,
        desc:"Prototype placeholder. Later this will open an interactive tool inside Sahatna space.",
        options:[
          {k:"Stage", v: STAGES[state.stage].name},
          {k:"Personalization", v: state.profileSet ? "Configured" : "Not set"}
        ],
        primaryLabel:"Launch",
        primaryAction: ()=> showToast(`${title} launched (prototype).`)
      });
    }

    function handleAction(id){
      if(id === "verify"){
        openModal({
          title:"Confirm test result",
          desc:"Prototype: record confirmation date/time and facility.",
          options:[
            {k:"Facility", v:"Hospital (TBD)", onClick: ()=>showToast("Choose facility (prototype).")},
            {k:"Date", v:"Today", onClick: ()=>showToast("Pick date (prototype).")}
          ],
          primaryLabel:"Confirm",
          primaryAction: ()=> showToast("Result confirmed (prototype).")
        });
      } else if(id === "profile"){
        setView("profile");
        showToast("Open preferences.");
      } else if(id === "scan"){
        setView("appointments");
      } else if(id === "vitamins"){
        state.remindersEnabled = true;
        showToast("Daily reminder enabled (prototype).");
        render();
      } else if(id === "birthplan"){
        openTool("Birth plan");
      } else if(id === "bag"){
        openTool("Hospital bag checklist");
      } else if(id === "followup"){
        setView("appointments");
      } else if(id === "newborn"){
        openTool("Newborn routine");
      } else {
        showToast("Action (prototype).");
      }
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ===== Event wiring =====
    // Stage pill clicks
    stageBar.addEventListener("click", (e)=>{
      const el = e.target.closest(".stage");
      if(!el) return;
      setStage(el.dataset.stage);
    });
    stageBar.addEventListener("keydown", (e)=>{
      const el = e.target.closest(".stage");
      if(!el) return;
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        setStage(el.dataset.stage);
      }
    });

    // Bottom nav
    navBtns.forEach(btn=>{
      btn.addEventListener("click", ()=> setView(btn.dataset.view));
    });

    // Modal close
    modalClose.onclick = closeModal;
    modalBack.addEventListener("click", (e)=>{
      if(e.target === modalBack) closeModal();
    });

    // Header buttons
    document.getElementById("infoBtn").onclick = ()=>{
      openModal({
        title:"Having a Baby • Overview",
        desc:"This is the initial interactive prototype for the Sahatna space journey. Next step: define exact content and actions per stage (pre-conception, pregnancy, birth, post-birth).",
        options:[
          {k:"Current stage", v: STAGES[state.stage].name, onClick: ()=> openStagePicker()},
          {k:"Open", v:"Resources", onClick: ()=> setView("resources")}
        ],
        primaryLabel:"OK",
        primaryAction: ()=>{}
      });
    };
    document.getElementById("backBtn").onclick = ()=> showToast("Back (prototype).");

    // Initial render
    render();
  </script>
</body>
</html>
