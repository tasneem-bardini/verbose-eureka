<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TAMM • Sahatna • Having a Baby (Prototype)</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1620;
      --card:#111a24;
      --text:#e8f0ff;
      --muted:rgba(232,240,255,.65);
      --muted2:rgba(232,240,255,.45);
      --line:rgba(255,255,255,.08);
      --accent:#19e3c0;
      --accent2:#21b9ff;
      --chip:rgba(255,255,255,.08);
      --shadow: 0 16px 40px rgba(0,0,0,.55);
      --radius:18px;
      --radius2:22px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background:
        radial-gradient(1200px 700px at 70% -10%, rgba(33,185,255,.25), transparent 55%),
        radial-gradient(900px 600px at -10% 20%, rgba(25,227,192,.16), transparent 55%),
        linear-gradient(180deg, #0b0f14 0%, #070a0e 100%);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    /* Phone frame */
    .phone{
      width:min(420px, 100%);
      height: min(860px, 100%);
      background: linear-gradient(180deg, #070b10 0%, #0b0f14 35%, #070a0e 100%);
      border-radius: 34px;
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .statusbar{
      height:34px;
      padding:10px 14px 0;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      font-size:12px;
      color:rgba(232,240,255,.7);
      letter-spacing:.2px;
    }
    .statusbar .right{display:flex; gap:10px; align-items:center}
    .pill-dot{width:10px;height:10px;border-radius:999px;background:rgba(232,240,255,.35)}
    .notch{
      position:absolute; top:10px; left:50%;
      transform:translateX(-50%);
      width:140px; height:24px;
      border-radius:999px;
      background:rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(8px);
      pointer-events:none;
      opacity:.75;
    }

    /* Top gradient header */
    .header{
      padding:14px 16px 14px;
      position:relative;
      background:
        radial-gradient(220px 160px at 30% 10%, rgba(33,185,255,.35), transparent 60%),
        radial-gradient(280px 180px at 70% -10%, rgba(25,227,192,.22), transparent 62%),
        linear-gradient(180deg, rgba(20,88,140,.55) 0%, rgba(10,20,32,.0) 70%);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .toprow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .iconbtn{
      width:36px; height:36px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      display:grid; place-items:center;
      cursor:pointer;
      transition:transform .12s ease, background .12s ease;
      user-select:none;
    }
    .iconbtn:active{transform:scale(.96)}
    .iconbtn:hover{background:rgba(255,255,255,.06)}
    .titlewrap{
      display:flex; flex-direction:column;
      line-height:1.15;
      gap:3px;
      min-width:0;
      flex:1;
    }
    .space{
      font-size:12px;
      color:rgba(232,240,255,.65);
    }
    .journey{
      font-size:20px;
      font-weight:750;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .subtitle{
      font-size:12px;
      color:rgba(232,240,255,.55);
      margin-top:2px;
    }

    .stagebar{
      display:flex;
      gap:8px;
      overflow:auto;
      padding-bottom:2px;
      scrollbar-width:none;
    }
    .stagebar::-webkit-scrollbar{display:none}
    .stage{
      flex:0 0 auto;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.08);
      color:rgba(232,240,255,.75);
      font-size:12px;
      cursor:pointer;
      user-select:none;
      transition:background .15s ease, transform .12s ease, border-color .15s ease;
      display:flex; align-items:center; gap:8px;
    }
    .stage .dot{width:8px;height:8px;border-radius:999px;background:rgba(232,240,255,.30)}
    .stage.active{
      background:linear-gradient(135deg, rgba(25,227,192,.20), rgba(33,185,255,.18));
      border-color:rgba(33,185,255,.35);
      color:rgba(232,240,255,.95);
    }
    .stage.active .dot{background:var(--accent)}
    .stage:active{transform:scale(.98)}

    /* Content */
    .content{
      height: calc(100% - 34px - 0px);
      overflow:auto;
      padding:14px 14px 110px;
      scrollbar-width:thin;
      scrollbar-color: rgba(255,255,255,.12) transparent;
    }
    .section{margin-top:12px}
    .sectionhead{
      display:flex; align-items:center; justify-content:space-between;
      margin:14px 2px 10px;
    }
    .sectionhead h3{margin:0;font-size:14px;letter-spacing:.2px}
    .linkbtn{
      border:none;background:none;
      color:rgba(33,185,255,.95);
      font-size:12px;cursor:pointer;
      padding:6px 8px;border-radius:10px;
    }
    .linkbtn:hover{background:rgba(33,185,255,.08)}

    .card{
      background:linear-gradient(180deg, rgba(17,26,36,.92), rgba(13,19,28,.92));
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius2);
      padding:14px;
      box-shadow: 0 14px 30px rgba(0,0,0,.35);
    }
    .card + .card{margin-top:10px}
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .muted{color:var(--muted)}
    .muted2{color:var(--muted2)}
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    .chip{
      font-size:11px;
      padding:7px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.08);
      color:rgba(232,240,255,.70);
    }

    .cta{display:flex; gap:10px; margin-top:12px}
    .btn{
      border:none; cursor:pointer;
      border-radius:999px;
      padding:11px 14px;
      font-weight:650;
      font-size:13px;
      letter-spacing:.15px;
      transition:transform .12s ease, filter .12s ease, background .12s ease;
      user-select:none;
    }
    .btn:active{transform:scale(.98)}
    .btn.primary{
      background:linear-gradient(135deg, rgba(25,227,192,1), rgba(33,185,255,.85));
      color:#052019;
      flex:1;
    }
    .btn.ghost{
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      color:rgba(232,240,255,.90);
    }
    .btn.small{padding:9px 12px; font-size:12px}

    .kpiwrap{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px}
    .kpi{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      padding:12px;
    }
    .kpi .label{font-size:11px;color:rgba(232,240,255,.60)}
    .kpi .value{font-size:18px;font-weight:800;margin-top:4px}
    .kpi .hint{font-size:11px;color:rgba(232,240,255,.45);margin-top:4px}

    .progress{
      margin-top:10px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      border-radius:999px;
      height:10px;
      overflow:hidden;
    }
    .progress > div{
      height:100%;
      width:0%;
      background:linear-gradient(90deg, rgba(25,227,192,1), rgba(33,185,255,.9));
      border-radius:999px;
      transition:width .25s ease;
    }

    /* List items */
    .list{display:flex; flex-direction:column; gap:10px}
    .item{
      background:linear-gradient(180deg, rgba(15,23,33,.88), rgba(12,18,26,.88));
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px;
      padding:12px;
      display:flex;
      gap:12px;
      cursor:pointer;
      transition:transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .item:hover{
      background:linear-gradient(180deg, rgba(15,26,38,.92), rgba(12,18,26,.92));
      border-color:rgba(33,185,255,.20);
    }
    .item:active{transform:scale(.99)}
    .thumb{
      width:56px;height:56px;border-radius:14px;
      background:
        radial-gradient(40px 40px at 30% 30%, rgba(33,185,255,.35), transparent 65%),
        radial-gradient(50px 50px at 80% 20%, rgba(25,227,192,.25), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.08), rgba(0,0,0,.05));
      border:1px solid rgba(255,255,255,.08);
      flex:0 0 auto;
      display:grid; place-items:center;
      color:rgba(232,240,255,.80);
    }
    .item .meta{min-width:0}
    .item .meta .t{
      font-weight:750;
      font-size:13px;
      margin:2px 0 4px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .item .meta .d{
      font-size:12px; color:rgba(232,240,255,.55);
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;
      overflow:hidden;
    }
    .tags{display:flex; flex-wrap:wrap; gap:6px; margin-top:8px}
    .tag{
      font-size:11px; padding:5px 8px; border-radius:999px;
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.08);
      color:rgba(232,240,255,.65);
    }
    .chev{margin-left:auto;color:rgba(232,240,255,.35);display:flex;align-items:center;padding-left:6px}

    .divider{height:1px;background:rgba(255,255,255,.06);margin:10px 0}
    .empty{
      font-size:12px;
      color:rgba(232,240,255,.50);
      padding:10px 12px;
      background:rgba(255,255,255,.04);
      border:1px dashed rgba(255,255,255,.12);
      border-radius:16px;
    }

    /* Modal */
    .modalback{
      position:absolute; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding:12px;
    }
    .modal{
      width:100%;
      max-width:420px;
      background:linear-gradient(180deg, rgba(18,26,38,.98), rgba(10,14,20,.98));
      border:1px solid rgba(255,255,255,.10);
      border-radius:26px;
      box-shadow: var(--shadow);
      padding:14px;
      transform:translateY(6px);
      animation: up .16s ease-out;
    }
    @keyframes up{from{transform:translateY(18px); opacity:.6} to{transform:translateY(6px); opacity:1}}
    .modal .handle{width:46px;height:5px;border-radius:999px;background:rgba(255,255,255,.18);margin:4px auto 10px}
    .modal h4{margin:4px 2px 6px; font-size:14px}
    .modal p{margin:0 2px 10px; font-size:12px; color:rgba(232,240,255,.58); line-height:1.45; white-space:pre-wrap}
    .modal .grid{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:8px}
    .modal .opt{
      padding:12px;border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.06);
      cursor:pointer;
      transition:transform .12s ease, background .12s ease;
    }
    .modal .opt:hover{background:rgba(33,185,255,.10)}
    .modal .opt:active{transform:scale(.99)}
    .modal .opt .k{font-size:11px; color:rgba(232,240,255,.60)}
    .modal .opt .v{font-size:13px; font-weight:750; margin-top:4px}

    /* Bottom nav */
    .nav{
      position:absolute; left:0; right:0; bottom:0;
      padding:10px 10px 14px;
      background:linear-gradient(180deg, rgba(11,15,20,0) 0%, rgba(11,15,20,.75) 25%, rgba(11,15,20,.96) 100%);
      border-top:1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(10px);
    }
    .navrow{
      display:flex; justify-content:space-around; gap:10px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:22px;
      padding:10px 8px;
    }
    .navbtn{
      display:flex; flex-direction:column; align-items:center; gap:6px;
      font-size:11px; color:rgba(232,240,255,.55);
      padding:8px 10px;
      border-radius:16px;
      cursor:pointer;
      user-select:none;
    }
    .navbtn.active{
      color:rgba(232,240,255,.92);
      background:linear-gradient(135deg, rgba(25,227,192,.16), rgba(33,185,255,.14));
      border:1px solid rgba(33,185,255,.18);
    }
    .navicon{
      width:22px;height:22px;border-radius:8px;
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.08);
      display:grid; place-items:center;
      color:rgba(232,240,255,.70);
    }

    /* Toast */
    .toast{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom:92px;
      background:rgba(12,18,26,.95);
      border:1px solid rgba(255,255,255,.10);
      border-radius:999px;
      padding:10px 12px;
      font-size:12px;
      color:rgba(232,240,255,.85);
      display:none;
      box-shadow:0 10px 30px rgba(0,0,0,.5);
      white-space:nowrap;
      max-width:90%;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Simple icons */
    .svg{width:16px;height:16px; display:block}
    .svg.big{width:18px;height:18px}
  </style>
</head>
<body>
  <div class="phone" role="application" aria-label="TAMM prototype phone">
    <div class="notch" aria-hidden="true"></div>

    <div class="statusbar">
      <div>9:41</div>
      <div class="right">
        <div class="pill-dot"></div>
        <div class="pill-dot"></div>
        <div class="pill-dot"></div>
      </div>
    </div>

    <div class="header">
      <div class="toprow">
        <button class="iconbtn" id="backBtn" aria-label="Back">
          <svg class="svg big" viewBox="0 0 24 24" fill="none">
            <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <div class="titlewrap">
          <div class="space">Sahatna Space</div>
          <div class="journey">Having a Baby</div>
          <div class="subtitle" id="stageSubtitle">Pregnancy services started • Profile created</div>
        </div>

        <button class="iconbtn" id="infoBtn" aria-label="Info">
          <svg class="svg big" viewBox="0 0 24 24" fill="none">
            <path d="M12 17v-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M12 7h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            <path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      </div>

      <div class="stagebar" id="stagebar" aria-label="Journey stages">
        <div class="stage" data-stage="pre" role="button" tabindex="0"><span class="dot"></span>Pre-conception</div>
        <div class="stage active" data-stage="preg" role="button" tabindex="0"><span class="dot"></span>Pregnancy</div>
        <div class="stage" data-stage="birth" role="button" tabindex="0"><span class="dot"></span>Birth</div>
        <div class="stage" data-stage="post" role="button" tabindex="0"><span class="dot"></span>Post-birth</div>
      </div>
    </div>

    <div class="content" id="content">
      <!-- Dynamic content injected here -->
    </div>

    <div class="toast" id="toast"></div>

    <div class="nav" aria-label="Bottom navigation">
      <div class="navrow">
        <div class="navbtn active" data-view="dashboard">
          <div class="navicon">
            <svg class="svg" viewBox="0 0 24 24" fill="none">
              <path d="M4 11h7V4H4v7Zm9 9h7v-7h-7v7ZM4 20h7v-7H4v7Zm9-9h7V4h-7v7Z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
            </svg>
          </div>
          Dashboard
        </div>
        <div class="navbtn" data-view="resources">
          <div class="navicon">
            <svg class="svg" viewBox="0 0 24 24" fill="none">
              <path d="M6 4h12v16H6V4Z" stroke="currentColor" stroke-width="1.8"/>
              <path d="M9 8h6M9 12h6M9 16h4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </div>
          Resources
        </div>
        <div class="navbtn" data-view="appointments">
          <div class="navicon">
            <svg class="svg" viewBox="0 0 24 24" fill="none">
              <path d="M7 3v3M17 3v3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M4 8h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M6 6h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="1.8"/>
              <path d="M8 12h4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </div>
          Appointments
        </div>
        <div class="navbtn" data-view="profile">
          <div class="navicon">
            <svg class="svg" viewBox="0 0 24 24" fill="none">
              <path d="M20 21a8 8 0 1 0-16 0" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M12 13a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke="currentColor" stroke-width="1.8"/>
            </svg>
          </div>
          Me
        </div>
      </div>
    </div>

    <!-- Bottom sheet modal -->
    <div class="modalback" id="modalBack" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-label="Details">
        <div class="handle"></div>
        <h4 id="modalTitle">Title</h4>
        <p id="modalDesc">Description</p>
        <div class="divider"></div>
        <div class="grid" id="modalGrid"></div>
        <div class="cta">
          <button class="btn ghost" id="modalClose">Close</button>
          <button class="btn primary" id="modalPrimary">Take action</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // 1) Core requirement updates:
    //    - Auto-create profile
    //    - Auto-start pregnancy services
    //    - Auto-book a set of appointments through birth
    // =========================

    const STAGES = {
      pre: {
        name: "Pre-conception",
        subtitle: "Planning • Content shown for completeness (pregnancy already started)",
        heroTitle: "Planning (archived)",
        heroDesc: "Pregnancy has started from the hospital confirmation. This stage remains visible for prototype navigation only.",
        resources: [
          { id:"pre1", title:"Planning basics", desc:"Prototype placeholder resource.", tags:["Basics"] },
        ]
      },
      preg: {
        name: "Pregnancy",
        subtitle: "Pregnancy services started • Tailored education & milestones",
        heroTitle: "Track progress with confidence",
        heroDesc: "Your profile was auto-created from the hospital record. Key appointments were auto-booked to guide you to birth (prototype).",
        resources: [
          { id:"r1", title:"What to expect in the first trimester", desc:"Symptoms, warning signs, and what’s normal.", tags:["Trimester 1","Guidance"] },
          { id:"r2", title:"Nutrition & supplements", desc:"Food safety, hydration, and daily routines.", tags:["Nutrition","Safety"] },
          { id:"r3", title:"Scans & screening explained", desc:"Why scans matter and how to prepare.", tags:["Scans","Screening"] },
          { id:"r4", title:"Mental wellbeing in pregnancy", desc:"Stress, sleep, and when to seek support.", tags:["Wellbeing","Support"] }
        ]
      },
      birth: {
        name: "Birth",
        subtitle: "Birth • Plan delivery & prepare for hospital",
        heroTitle: "Prepare for delivery",
        heroDesc: "Build your birth plan, pack essentials, and review admission steps.",
        resources: [
          { id:"b1", title:"Signs of labor", desc:"What to watch for and when to go to hospital.", tags:["Labor","Urgent"] },
          { id:"b2", title:"Hospital admission checklist", desc:"Documents and what to expect at triage.", tags:["Hospital","Checklist"] }
        ]
      },
      post: {
        name: "Post-birth",
        subtitle: "Post-birth • Recovery, newborn care & follow-ups",
        heroTitle: "Care designed for you and your child",
        heroDesc: "Recovery, feeding guidance, immunizations, and postnatal follow-ups.",
        resources: [
          { id:"p1", title:"Postnatal recovery guide", desc:"Physical recovery and warning signs.", tags:["Recovery","Guidance"] },
          { id:"p2", title:"Newborn feeding basics", desc:"Feeding guidance and when to seek help.", tags:["Feeding","Basics"] }
        ]
      }
    };

    const VIEWS = ["dashboard","resources","appointments","profile"];

    // ===== UI refs =====
    const contentEl = document.getElementById("content");
    const stageSubtitle = document.getElementById("stageSubtitle");
    const stageBar = document.getElementById("stagebar");
    const navBtns = Array.from(document.querySelectorAll(".navbtn"));
    const toastEl = document.getElementById("toast");

    // Modal
    const modalBack = document.getElementById("modalBack");
    const modalTitle = document.getElementById("modalTitle");
    const modalDesc  = document.getElementById("modalDesc");
    const modalGrid  = document.getElementById("modalGrid");
    const modalClose = document.getElementById("modalClose");
    const modalPrimary = document.getElementById("modalPrimary");

    // ===== State =====
    let state = {
      stage: "preg",              // auto-start pregnancy services
      view: "dashboard",
      onboardingComplete: true,   // auto-created
      profileSet: true,           // auto-created
      remindersEnabled: true,     // default on for pregnancy services
      journeyInitialized: false,
      journey: {
        hospitalEvent: {
          facility: "Hospital (prototype)",
          event: "Positive pregnancy test confirmed",
          date: new Date()
        },
        testDate: new Date(),
        dueDate: addDays(new Date(), 260), // prototype default
        appointments: []                  // auto-booked
      }
    };

    // ===== Helpers =====
    function showToast(msg){
      toastEl.textContent = msg;
      toastEl.style.display = "block";
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> toastEl.style.display = "none", 2200);
    }

    function openModal({title, desc, options = [], primaryLabel="Done", primaryAction=()=>{}}){
      modalTitle.textContent = title;
      modalDesc.textContent = desc;
      modalGrid.innerHTML = "";
      options.forEach(opt=>{
        const div = document.createElement("div");
        div.className = "opt";
        div.innerHTML = `<div class="k">${escapeHtml(opt.k)}</div><div class="v">${escapeHtml(opt.v)}</div>`;
        div.onclick = () => opt.onClick?.();
        modalGrid.appendChild(div);
      });
      modalPrimary.textContent = primaryLabel;
      modalPrimary.onclick = () => { primaryAction(); closeModal(); };
      modalBack.style.display = "flex";
      modalBack.setAttribute("aria-hidden","false");
    }

    function closeModal(){
      modalBack.style.display = "none";
      modalBack.setAttribute("aria-hidden","true");
    }

    function setStage(stageKey){
      state.stage = stageKey;
      Array.from(stageBar.querySelectorAll(".stage")).forEach(el=>{
        el.classList.toggle("active", el.dataset.stage === stageKey);
      });
      stageSubtitle.textContent = STAGES[stageKey].subtitle;
      render();
      showToast(`Stage: ${STAGES[stageKey].name}`);
    }

    function setView(view){
      state.view = view;
      navBtns.forEach(b=> b.classList.toggle("active", b.dataset.view === view));
      render();
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function addDays(date, days){
      const d = new Date(date);
      d.setDate(d.getDate() + days);
      return d;
    }

    function daysBetween(a,b){
      const ms = (new Date(b)).getTime() - (new Date(a)).getTime();
      return Math.round(ms / (1000*60*60*24));
    }

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function fmtDate(d){
      const dd = new Date(d);
      return dd.toLocaleDateString(undefined, { weekday:"short", year:"numeric", month:"short", day:"numeric" });
    }

    function fmtShort(d){
      const dd = new Date(d);
      return dd.toLocaleDateString(undefined, { month:"short", day:"numeric" });
    }

    function svgBadge(kind){
      const map = {
        cal: `<svg class="svg" viewBox="0 0 24 24" fill="none">
          <path d="M7 3v3M17 3v3M4 8h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M6 6h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2"/>
        </svg>`,
        book: `<svg class="svg" viewBox="0 0 24 24" fill="none">
          <path d="M6 4h12v16H6V4Z" stroke="currentColor" stroke-width="2"/>
          <path d="M9 8h6M9 12h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>`,
        bolt: `<svg class="svg" viewBox="0 0 24 24" fill="none">
          <path d="M13 2L3 14h8l-1 8 11-13h-8l0-7Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </svg>`,
        heart: `<svg class="svg" viewBox="0 0 24 24" fill="none">
          <path d="M12 21s-7-4.35-9.5-9A5.8 5.8 0 0 1 12 5.8 5.8 5.8 0 0 1 21.5 12c-2.5 4.65-9.5 9-9.5 9Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </svg>`
      };
      return map[kind] || map.book;
    }

    // ===== Auto-booking logic (prototype) =====
    function generateAutoAppointments(testDate, dueDate){
      const t = new Date(testDate);
      const d = new Date(dueDate);

      // A "couple of appointments" interpreted as a small set of key ones, ending at birth.
      // You can adjust titles/offsets later in the next iteration.
      const templates = [
        { id:"a1", title:"First prenatal visit (OB-GYN / Midwife)", offset:3,  stage:"preg", type:"Consultation" },
        { id:"a2", title:"Dating ultrasound scan",                offset:10, stage:"preg", type:"Scan" },
        { id:"a3", title:"First trimester screening",             offset:35, stage:"preg", type:"Screening" },
        { id:"a4", title:"Anatomy scan (20-week scan)",           offset:90, stage:"preg", type:"Scan" },
        { id:"a5", title:"Glucose tolerance test",                offset:170,stage:"preg", type:"Lab" },
        { id:"a6", title:"Third trimester review",                offset:210,stage:"preg", type:"Consultation" },
        // Birth stage
        { id:"a7", title:"Birth plan appointment",                offset:240,stage:"birth",type:"Planning" },
        { id:"a8", title:"Delivery (estimated due date)",         offsetFromDue:0, stage:"birth", type:"Delivery" }
      ];

      const appts = templates.map(x=>{
        const date = (x.offsetFromDue !== undefined)
          ? addDays(d, x.offsetFromDue)
          : addDays(t, x.offset);

        return {
          id: x.id,
          title: x.title,
          date,
          stage: x.stage,
          type: x.type,
          status: "Booked",
          source: "Auto-booked from hospital confirmation",
          location: "Hospital / Clinic (prototype)"
        };
      });

      // Ensure chronological sort
      appts.sort((a,b)=> new Date(a.date) - new Date(b.date));
      return appts;
    }

    function initHospitalPositiveTestFlow(){
      if(state.journeyInitialized) return;

      // Auto-create profile & start pregnancy services
      state.onboardingComplete = true;
      state.profileSet = true;
      state.remindersEnabled = true;
      state.stage = "preg";
      state.view = "dashboard";

      // Auto-book appointments until birth
      state.journey.appointments = generateAutoAppointments(state.journey.testDate, state.journey.dueDate);

      state.journeyInitialized = true;

      // Visual feedback (prototype)
      setTimeout(()=>{
        showToast(`Profile created • ${state.journey.appointments.length} appointments booked`);
      }, 250);
    }

    function getUpcomingAppointments(){
      const now = new Date();
      return state.journey.appointments.filter(a => new Date(a.date) >= now);
    }

    function getNextAppointment(){
      const upcoming = getUpcomingAppointments();
      return upcoming.length ? upcoming[0] : null;
    }

    function pregnancyProgress(){
      const start = new Date(state.journey.testDate);
      const end = new Date(state.journey.dueDate);
      const now = new Date();
      const total = Math.max(1, end - start);
      const elapsed = clamp(now - start, 0, total);
      const pct = (elapsed / total) * 100;

      // Very rough week estimate for prototype
      const days = Math.max(0, Math.round(elapsed / (1000*60*60*24)));
      const week = Math.max(1, Math.floor(days / 7) + 1);

      return { pct: clamp(pct, 0, 100), week };
    }

    function openDueDateEditor(){
      const old = new Date(state.journey.dueDate);
      openModal({
        title: "Edit due date (estimated)",
        desc: "Prototype control. Changing the due date will re-generate the auto-booked appointments.",
        options: [
          { k:"Current", v: fmtDate(old) },
          { k:"Adjust", v:"+ 1 week", onClick: ()=>{ state.journey.dueDate = addDays(old, 7); rebook(); } },
          { k:"Adjust", v:"- 1 week", onClick: ()=>{ state.journey.dueDate = addDays(old, -7); rebook(); } },
          { k:"Adjust", v:"+ 2 weeks", onClick: ()=>{ state.journey.dueDate = addDays(old, 14); rebook(); } },
          { k:"Adjust", v:"- 2 weeks", onClick: ()=>{ state.journey.dueDate = addDays(old, -14); rebook(); } }
        ],
        primaryLabel: "Done",
        primaryAction: ()=>{}
      });

      function rebook(){
        state.journey.appointments = generateAutoAppointments(state.journey.testDate, state.journey.dueDate);
        showToast("Appointments re-booked (prototype).");
        render();
      }
    }

    function openAppointment(appt){
      openModal({
        title: appt.title,
        desc:
          `${fmtDate(appt.date)}\n` +
          `${appt.location}\n\n` +
          `Status: ${appt.status}\n` +
          `${appt.source}\n\n` +
          `Later: clinician, location map, reschedule/cancel, prep instructions, check-in/queue.`,
        options: [
          { k:"Type", v: appt.type },
          { k:"Stage", v: STAGES[appt.stage]?.name || appt.stage },
          { k:"Reminders", v: state.remindersEnabled ? "On" : "Off", onClick: ()=>{ state.remindersEnabled = !state.remindersEnabled; showToast("Toggled reminders."); render(); } },
          { k:"Reschedule", v:"(placeholder)", onClick: ()=> showToast("Reschedule (prototype).") }
        ],
        primaryLabel: "OK",
        primaryAction: ()=>{}
      });
    }

    function openResource(resourceId){
      const r = STAGES[state.stage].resources.find(x=>x.id===resourceId);
      if(!r) return;
      openModal({
        title: r.title,
        desc: r.desc + "\n\nLater: full article/video, save/bookmark, and stage-aware recommendations.",
        options: [
          { k:"Stage", v: STAGES[state.stage].name },
          { k:"Save", v:"Bookmark", onClick: ()=> showToast("Saved (prototype).") },
          { k:"Share", v:"Send link", onClick: ()=> showToast("Share (prototype).") },
          { k:"Feedback", v:"Helpful / Not", onClick: ()=> showToast("Feedback (prototype).") }
        ],
        primaryLabel: "Open",
        primaryAction: ()=> showToast("Open resource (prototype).")
      });
    }

    // ===== Renderers =====
    function renderDashboard(){
      const s = STAGES[state.stage];
      const next = getNextAppointment();
      const upcoming = getUpcomingAppointments();
      const prog = pregnancyProgress();

      const due = fmtDate(state.journey.dueDate);
      const test = fmtDate(state.journey.testDate);

      const hospitalCard = `
        <div class="card">
          <div class="row">
            <div style="min-width:0">
              <div style="font-size:12px;color:rgba(232,240,255,.60);margin-bottom:6px">Hospital-triggered start</div>
              <div style="font-size:16px;font-weight:820;letter-spacing:.2px">${escapeHtml(state.journey.hospitalEvent.event)}</div>
              <div class="muted" style="font-size:12px;line-height:1.45;margin-top:6px">
                Facility: ${escapeHtml(state.journey.hospitalEvent.facility)}<br/>
                Confirmation date: ${test}<br/>
                Profile: <b>Auto-created</b> • Pregnancy services: <b>Active</b>
              </div>
              <div class="chips">
                <span class="chip">Auto-booked appointments</span>
                <span class="chip">Tailored education</span>
                <span class="chip">Reminders ${state.remindersEnabled ? "On" : "Off"}</span>
              </div>
            </div>
            <div class="thumb" aria-hidden="true">${svgBadge("heart")}</div>
          </div>
          <div class="cta">
            <button class="btn primary" id="btnViewSchedule">View schedule</button>
            <button class="btn ghost" id="btnEditDue">Edit due date</button>
          </div>
        </div>
      `;

      const overview = `
        <div class="card">
          <div class="row">
            <div style="min-width:0">
              <div style="font-size:12px;color:rgba(232,240,255,.60);margin-bottom:6px">Pregnancy overview</div>
              <div style="font-size:18px;font-weight:820">${s.heroTitle}</div>
              <div class="muted" style="font-size:12px;line-height:1.45;margin-top:6px">${s.heroDesc}</div>
              <div class="progress" aria-label="Pregnancy progress"><div id="progBar"></div></div>
              <div class="muted2" style="font-size:11px;margin-top:8px">
                Progress: ~Week ${prog.week} (prototype estimate)
              </div>
            </div>
            <div class="thumb" aria-hidden="true">${svgBadge("bolt")}</div>
          </div>

          <div class="kpiwrap">
            <div class="kpi">
              <div class="label">Estimated due date</div>
              <div class="value">${due}</div>
              <div class="hint">Tap “Edit due date” to adjust</div>
            </div>
            <div class="kpi">
              <div class="label">Upcoming appointments</div>
              <div class="value">${upcoming.length}</div>
              <div class="hint">${upcoming.length ? "Auto-booked to birth" : "None"}</div>
            </div>
            <div class="kpi">
              <div class="label">Next appointment</div>
              <div class="value">${next ? fmtShort(next.date) : "—"}</div>
              <div class="hint">${next ? escapeHtml(next.title) : "No upcoming"}</div>
            </div>
            <div class="kpi">
              <div class="label">Stage</div>
              <div class="value">${s.name}</div>
              <div class="hint">Tailors content & schedule</div>
            </div>
          </div>
        </div>
      `;

      const nextAppointments = `
        <div class="section">
          <div class="sectionhead">
            <h3>Next appointments</h3>
            <button class="linkbtn" id="apptsAll">View all</button>
          </div>
          ${
            upcoming.length
              ? `<div class="list">
                  ${upcoming.slice(0,3).map(a=>`
                    <div class="item" data-item="appt" data-id="${a.id}">
                      <div class="thumb">${svgBadge("cal")}</div>
                      <div class="meta">
                        <div class="t">${escapeHtml(a.title)}</div>
                        <div class="d">${fmtDate(a.date)} • ${escapeHtml(a.location)}</div>
                        <div class="tags">
                          <span class="tag">${escapeHtml(a.type)}</span>
                          <span class="tag">${escapeHtml(a.status)}</span>
                          <span class="tag">${STAGES[a.stage]?.name || a.stage}</span>
                        </div>
                      </div>
                      <div class="chev">›</div>
                    </div>
                  `).join("")}
                </div>`
              : `<div class="empty">No upcoming appointments (prototype).</div>`
          }
        </div>
      `;

      const education = `
        <div class="section">
          <div class="sectionhead">
            <h3>Tailored Education</h3>
            <button class="linkbtn" id="resourcesAll">View all</button>
          </div>

          <div class="list">
            ${s.resources.slice(0,3).map((r,i)=>`
              <div class="item" data-item="resource" data-id="${r.id}">
                <div class="thumb">${svgBadge("book")}</div>
                <div class="meta">
                  <div class="t">${escapeHtml(r.title)}</div>
                  <div class="d">${escapeHtml(r.desc)}</div>
                  <div class="tags">${r.tags.map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("")}</div>
                </div>
                <div class="chev">›</div>
              </div>
            `).join("")}
          </div>
        </div>
      `;

      const wellness = `
        <div class="section">
          <div class="sectionhead">
            <h3>My Wellness</h3>
            <button class="linkbtn" id="wellnessAll">View all</button>
          </div>

          <div class="card">
            <div class="row">
              <div style="min-width:0">
                <div style="font-weight:820">Connect your smart device</div>
                <div class="muted" style="font-size:12px;margin-top:5px;line-height:1.45">
                  Optional pregnancy wellness insights (prototype placeholder).
                </div>
              </div>
              <div class="thumb" aria-hidden="true">${svgBadge("heart")}</div>
            </div>
            <div class="cta">
              <button class="btn primary" id="connectDevice">Connect device</button>
              <button class="btn ghost" id="privacy">Privacy</button>
            </div>
          </div>
        </div>
      `;

      contentEl.innerHTML = hospitalCard + overview + nextAppointments + education + wellness;

      // set progress bar width
      requestAnimationFrame(()=>{
        const bar = document.getElementById("progBar");
        if(bar) bar.style.width = prog.pct.toFixed(0) + "%";
      });

      // Wire up
      document.getElementById("btnViewSchedule").onclick = ()=> setView("appointments");
      document.getElementById("btnEditDue").onclick = ()=> openDueDateEditor();
      document.getElementById("apptsAll").onclick = ()=> setView("appointments");
      document.getElementById("resourcesAll").onclick = ()=> setView("resources");

      document.getElementById("connectDevice").onclick = ()=> showToast("Connect device (prototype).");
      document.getElementById("privacy").onclick = ()=> openModal({
        title:"Privacy (prototype)",
        desc:"Placeholder for consent, sharing, and data visibility.",
        options:[
          {k:"Medical data", v:"Used for personalization", onClick: ()=>showToast("Medical consent (prototype).")},
          {k:"Device data", v:"Optional", onClick: ()=>showToast("Device consent (prototype).")}
        ],
        primaryLabel:"Got it",
        primaryAction: ()=>{}
      });

      // Appointment + Resource open
      contentEl.querySelectorAll('[data-item="appt"]').forEach(el=>{
        el.onclick = ()=>{
          const id = el.dataset.id;
          const appt = state.journey.appointments.find(a=>a.id===id);
          if(appt) openAppointment(appt);
        };
      });
      contentEl.querySelectorAll('[data-item="resource"]').forEach(el=>{
        el.onclick = ()=> openResource(el.dataset.id);
      });
    }

    function renderResources(){
      const s = STAGES[state.stage];

      const header = `
        <div class="card">
          <div class="row">
            <div style="min-width:0">
              <div style="font-size:12px;color:rgba(232,240,255,.60);margin-bottom:6px">Tailored education • ${s.name}</div>
              <div style="font-size:18px;font-weight:820">Resources</div>
              <div class="muted" style="font-size:12px;line-height:1.45;margin-top:6px">
                Prototype: stage-aware list. Next iteration can add trimester/week personalization and clinical guidelines.
              </div>
            </div>
            <div class="thumb">${svgBadge("book")}</div>
          </div>
          <div class="cta">
            <button class="btn ghost" id="filterBtn">Filter</button>
            <button class="btn ghost" id="sortBtn">Sort</button>
            <button class="btn primary" id="assessmentBtn">Quick assessment</button>
          </div>
        </div>
      `;

      const list = `
        <div class="section">
          <div class="list">
            ${s.resources.map(r=>`
              <div class="item" data-item="resource" data-id="${r.id}">
                <div class="thumb">${svgBadge("book")}</div>
                <div class="meta">
                  <div class="t">${escapeHtml(r.title)}</div>
                  <div class="d">${escapeHtml(r.desc)}</div>
                  <div class="tags">${r.tags.map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("")}</div>
                </div>
                <div class="chev">›</div>
              </div>
            `).join("")}
          </div>
        </div>
      `;

      contentEl.innerHTML = header + list;

      document.getElementById("filterBtn").onclick = ()=> showToast("Filter (prototype).");
      document.getElementById("sortBtn").onclick = ()=> showToast("Sort (prototype).");
      document.getElementById("assessmentBtn").onclick = ()=> openModal({
        title:"Quick assessment (prototype)",
        desc:"Later: a short questionnaire to tailor content and appointment nudges.",
        options:[
          {k:"Goal", v:"Tailor content"},
          {k:"Time", v:"~2 min"}
        ],
        primaryLabel:"Start",
        primaryAction: ()=> showToast("Assessment started (prototype).")
      });

      contentEl.querySelectorAll('[data-item="resource"]').forEach(el=>{
        el.onclick = ()=> openResource(el.dataset.id);
      });
    }

    function renderAppointments(){
      const upcoming = getUpcomingAppointments();
      const all = state.journey.appointments;

      const card = `
        <div class="card">
          <div class="row">
            <div style="min-width:0">
              <div style="font-size:12px;color:rgba(232,240,255,.60);margin-bottom:6px">Appointments</div>
              <div style="font-size:18px;font-weight:820">Auto-booked schedule</div>
              <div class="muted" style="font-size:12px;line-height:1.45;margin-top:6px">
                Created automatically after the hospital confirmed the positive pregnancy test (prototype).
              </div>
            </div>
            <div class="thumb">${svgBadge("cal")}</div>
          </div>
          <div class="cta">
            <button class="btn primary" id="bookExtra">Book extra appointment</button>
            <button class="btn ghost" id="toggleReminders">${state.remindersEnabled ? "Disable reminders" : "Enable reminders"}</button>
          </div>
        </div>
      `;

      const upcomingBlock = `
        <div class="section">
          <div class="sectionhead">
            <h3>Upcoming</h3>
            <button class="linkbtn" id="editDueLink">Edit due date</button>
          </div>
          ${
            upcoming.length
              ? `<div class="list">
                  ${upcoming.map(a=>`
                    <div class="item" data-item="appt" data-id="${a.id}">
                      <div class="thumb">${svgBadge("cal")}</div>
                      <div class="meta">
                        <div class="t">${escapeHtml(a.title)}</div>
                        <div class="d">${fmtDate(a.date)} • ${escapeHtml(a.location)}</div>
                        <div class="tags">
                          <span class="tag">${escapeHtml(a.type)}</span>
                          <span class="tag">${STAGES[a.stage]?.name || a.stage}</span>
                          <span class="tag">${escapeHtml(a.status)}</span>
                        </div>
                      </div>
                      <div class="chev">›</div>
                    </div>
                  `).join("")}
                </div>`
              : `<div class="empty">No upcoming appointments (prototype).</div>`
          }
        </div>
      `;

      const allBlock = `
        <div class="section">
          <div class="sectionhead"><h3>All (timeline)</h3></div>
          <div class="card">
            <div class="muted2" style="font-size:11px;margin-bottom:8px">
              Includes delivery (estimated). Next iteration can group by trimester, care pathway, and facility.
            </div>
            <div class="chips">
              ${all.map(a=>`<span class="chip">${fmtShort(a.date)} • ${escapeHtml(a.title)}</span>`).join("")}
            </div>
          </div>
        </div>
      `;

      contentEl.innerHTML = card + upcomingBlock + allBlock;

      document.getElementById("bookExtra").onclick = ()=> showToast("Book extra appointment (prototype).");
      document.getElementById("toggleReminders").onclick = ()=>{
        state.remindersEnabled = !state.remindersEnabled;
        showToast(state.remindersEnabled ? "Reminders enabled." : "Reminders disabled.");
        render();
      };
      document.getElementById("editDueLink").onclick = ()=> openDueDateEditor();

      contentEl.querySelectorAll('[data-item="appt"]').forEach(el=>{
        el.onclick = ()=>{
          const id = el.dataset.id;
          const appt = state.journey.appointments.find(a=>a.id===id);
          if(appt) openAppointment(appt);
        };
      });
    }

    function renderProfile(){
      const due = fmtDate(state.journey.dueDate);
      contentEl.innerHTML = `
        <div class="card">
          <div class="row">
            <div style="min-width:0">
              <div style="font-size:12px;color:rgba(232,240,255,.60);margin-bottom:6px">Me</div>
              <div style="font-size:18px;font-weight:820">Profile (auto-created)</div>
              <div class="muted" style="font-size:12px;line-height:1.45;margin-top:6px">
                Created automatically from the hospital confirmation. Next iteration: demographics, care pathway, language, consent.
              </div>
            </div>
            <div class="thumb">${svgBadge("heart")}</div>
          </div>

          <div class="kpiwrap">
            <div class="kpi">
              <div class="label">Profile status</div>
              <div class="value">${state.profileSet ? "Active" : "Not set"}</div>
              <div class="hint">Auto-created by hospital</div>
            </div>
            <div class="kpi">
              <div class="label">Due date (estimated)</div>
              <div class="value">${due}</div>
              <div class="hint">Drives appointment schedule</div>
            </div>
          </div>

          <div class="cta">
            <button class="btn primary" id="editPrefs">Edit preferences</button>
            <button class="btn ghost" id="consentBtn">Consent & privacy</button>
          </div>
        </div>

        <div class="section">
          <div class="sectionhead"><h3>Quick settings</h3></div>
          <div class="card" style="padding:10px">
            <div class="item" data-item="setting" data-title="Language">
              <div class="thumb">${svgBadge("book")}</div>
              <div class="meta">
                <div class="t">Language</div>
                <div class="d">English (prototype)</div>
              </div>
              <div class="chev">›</div>
            </div>
            <div class="item" data-item="setting" data-title="Reminders">
              <div class="thumb">${svgBadge("cal")}</div>
              <div class="meta">
                <div class="t">Reminders</div>
                <div class="d">${state.remindersEnabled ? "Enabled" : "Disabled"}</div>
              </div>
              <div class="chev">›</div>
            </div>
            <div class="item" data-item="setting" data-title="Estimated due date">
              <div class="thumb">${svgBadge("heart")}</div>
              <div class="meta">
                <div class="t">Estimated due date</div>
                <div class="d">${due}</div>
              </div>
              <div class="chev">›</div>
            </div>
          </div>
        </div>
      `;

      document.getElementById("editPrefs").onclick = ()=> showToast("Preferences saved (prototype).");
      document.getElementById("consentBtn").onclick = ()=> openModal({
        title:"Consent & privacy",
        desc:"Prototype placeholder. Next iteration: granular consent for medical info, device data, and personalization.",
        options:[
          {k:"Medical data", v:"Used for services", onClick: ()=>showToast("Medical consent (prototype).")},
          {k:"Device data", v:"Optional", onClick: ()=>showToast("Device consent (prototype).")}
        ],
        primaryLabel:"Save",
        primaryAction: ()=> showToast("Saved (prototype).")
      });

      contentEl.querySelectorAll('[data-item="setting"]').forEach(el=>{
        el.onclick = ()=>{
          if(el.dataset.title === "Estimated due date") openDueDateEditor();
          else if(el.dataset.title === "Reminders"){
            state.remindersEnabled = !state.remindersEnabled;
            showToast("Toggled reminders.");
            render();
          } else {
            showToast(`${el.dataset.title} (prototype).`);
          }
        };
      });
    }

    function render(){
      stageSubtitle.textContent = STAGES[state.stage].subtitle;

      if(state.view === "dashboard") renderDashboard();
      if(state.view === "resources") renderResources();
      if(state.view === "appointments") renderAppointments();
      if(state.view === "profile") renderProfile();
    }

    // ===== Event wiring =====
    stageBar.addEventListener("click", (e)=>{
      const el = e.target.closest(".stage");
      if(!el) return;
      setStage(el.dataset.stage);
    });
    stageBar.addEventListener("keydown", (e)=>{
      const el = e.target.closest(".stage");
      if(!el) return;
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        setStage(el.dataset.stage);
      }
    });

    navBtns.forEach(btn=>{
      btn.addEventListener("click", ()=> setView(btn.dataset.view));
    });

    modalClose.onclick = closeModal;
    modalBack.addEventListener("click", (e)=>{
      if(e.target === modalBack) closeModal();
    });

    document.getElementById("infoBtn").onclick = ()=>{
      const next = getNextAppointment();
      openModal({
        title:"Having a Baby • Services started",
        desc:
          "Auto-triggered by hospital confirmation.\n\n" +
          `Due date (est.): ${fmtDate(state.journey.dueDate)}\n` +
          `Appointments booked: ${state.journey.appointments.length}\n` +
          (next ? `Next: ${fmtDate(next.date)} • ${next.title}` : "Next: —"),
        options:[
          {k:"View", v:"Schedule", onClick: ()=> setView("appointments")},
          {k:"Edit", v:"Due date", onClick: ()=> openDueDateEditor()}
        ],
        primaryLabel:"OK",
        primaryAction: ()=>{}
      });
    };
    document.getElementById("backBtn").onclick = ()=> showToast("Back (prototype).");

    // ===== Boot =====
    initHospitalPositiveTestFlow();
    render();
  </script>
</body>
</html>
